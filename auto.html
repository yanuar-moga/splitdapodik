<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Rekap Nilai Siswa</title>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  select, button { padding: 8px 14px; margin: 6px 0; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  table, th, td { border: 1px solid #ccc; }
  th { background:#f5f5f5; }
  th, td { padding: 8px; text-align:left; }
</style>
</head>

<body>

<h2>ðŸ“Š Rekap Nilai Siswa</h2>

<!-- JSON Kelas (static - sangat cepat) -->
<script>
const daftarKelas = [
  "7A","7B","7C","7D","7E","7F","7G","7H","7I",
  "8A","8B","8C","8D","8E","8F","8G","8H","8I",
  "9A","9B","9C","9D","9E","9F","9G","9H","9I"
];
</script>

<label><b>Pilih Kelas:</b></label>
<select id="pilihKelas"></select>

<div id="tableDiv" style="margin-top:20px;">Silakan pilih kelasâ€¦</div>

<div id="downloadArea" style="margin-top:20px; display:none;">
  <h3>ðŸ“¥ Download Rekapan</h3>
  <button onclick="downloadExcel()">Download Excel</button>
  <button onclick="downloadPDF()">Download PDF</button>
</div>

<script>
// === KONFIGURASI GOOGLE SHEET ===
const sheetID = "MASUKKAN_ID_GOOGLE_SHEET_DI_SINI";  
const sheetName = "Sheet1";  

google.charts.load('current', {'packages':['table']});
google.charts.setOnLoadCallback(initKelas);

function initKelas() {
    const select = document.getElementById("pilihKelas");
    select.innerHTML = `<option value="">-- pilih kelas --</option>`;

    daftarKelas.forEach(k => {
        select.innerHTML += `<option value="${k}">${k}</option>`;
    });

    select.onchange = () => {
        const kelas = select.value;
        if (kelas) loadKelas(kelas);
    };
}

function loadKelas(kelas) {
    document.getElementById("tableDiv").innerHTML = "Memuat data kelas " + kelas + "...";

    const query = new google.visualization.Query(
        `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?sheet=${sheetName}
        &tq=${encodeURIComponent("select * where B = '" + kelas + "'")}`
        // catatan: kolom B = Kelas (ubah jika bukan B)
    );

    query.send(response => {
        if (response.isError()) {
            document.getElementById("tableDiv").innerHTML = "Gagal memuat data.";
            return;
        }

        const data = response.getDataTable();
        if (data.getNumberOfRows() === 0) {
            document.getElementById("tableDiv").innerHTML = "Tidak ada data kelas " + kelas;
            return;
        }

        const table = new google.visualization.Table(document.getElementById('tableDiv'));
        table.draw(data);

        // tampilkan tombol download
        document.getElementById("downloadArea").style.display = "block";
    });
}

function downloadExcel() {
    window.open(`https://docs.google.com/spreadsheets/d/${sheetID}/export?format=xlsx`);
}

function downloadPDF() {
    window.open(`https://docs.google.com/spreadsheets/d/${sheetID}/export?format=pdf`);
}
</script>

</body>
</html>
